"use strict";if(!window.setImmediate){window.setImmediate=function t(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function t(){if(!window.postMessage||!window.addEventListener){return null}var e=[undefined];var r="zero-timeout-message";var a=function t(a){var i=e.length;e.push(a);window.postMessage(r+i.toString(36),"*");return i};window.addEventListener("message",function t(a){if(typeof a.data!=="string"||a.data.substr(0,r.length)!==r){return}a.stopImmediatePropagation();var i=parseInt(a.data.substr(r.length),36);if(!e[i]){return}e[i]();e[i]=undefined},true);window.clearImmediate=function t(r){if(!e[r]){return}e[r]=undefined};return a}()||function t(e){window.setTimeout(e,0)}}()}if(!window.clearImmediate){window.clearImmediate=function t(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function t(e){window.clearTimeout(e)}}()}(function(t){var e=function t(){var e=document.createElement("canvas");if(!e||!e.getContext){return false}var r=e.getContext("2d");if(!r.getImageData){return false}if(!r.fillText){return false}if(!Array.prototype.some){return false}if(!Array.prototype.push){return false}return true}();var r=function t(){if(!e){return}var r=document.createElement("canvas").getContext("2d");var a=20;var i,n;while(a){r.font=a.toString(10)+"px sans-serif";if(r.measureText("uFF37").width===i&&r.measureText("m").width===n){return a+1}i=r.measureText("uFF37").width;n=r.measureText("m").width;a--}return 0}();var a=function t(e){for(var r,a,i=e.length;i;r=Math.floor(Math.random()*i),a=e[--i],e[i]=e[r],e[r]=a){}return e};var i=function t(i,n){if(!e){return}if(!Array.isArray(i)){i=[i]}i.forEach(function(t,e){if(typeof t==="string"){i[e]=document.getElementById(t);if(!i[e]){throw"The element id specified is not found."}}else if(!t.tagName&&!t.appendChild){throw"You must pass valid HTML elements, or ID of the element."}});var o={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", '+'"Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:true,backgroundColor:"#fff",gridSize:8,drawOutOfBound:false,origin:null,drawMask:false,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function t(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:true,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(n){for(var f in n){if(f in o){o[f]=n[f]}}}if(typeof o.weightFactor!=="function"){var l=o.weightFactor;o.weightFactor=function t(e){return e*l}}if(typeof o.shape!=="function"){switch(o.shape){case"circle":default:o.shape="circle";break;case"cardioid":o.shape=function t(e){return 1-Math.sin(e)};break;case"diamond":case"square":o.shape=function t(e){var r=e%(2*Math.PI/4);return 1/(Math.cos(r)+Math.sin(r))};break;case"triangle-forward":o.shape=function t(e){var r=e%(2*Math.PI/3);return 1/(Math.cos(r)+Math.sqrt(3)*Math.sin(r))};break;case"triangle":case"triangle-upright":o.shape=function t(e){var r=(e+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(r)+Math.sqrt(3)*Math.sin(r))};break;case"pentagon":o.shape=function t(e){var r=(e+.955)%(2*Math.PI/5);return 1/(Math.cos(r)+.726543*Math.sin(r))};break;case"star":o.shape=function t(e){var r=(e+.955)%(2*Math.PI/10);if((e+.955)%(2*Math.PI/5)-2*Math.PI/10>=0){return 1/(Math.cos(2*Math.PI/10-r)+3.07768*Math.sin(2*Math.PI/10-r))}else{return 1/(Math.cos(r)+3.07768*Math.sin(r))}};break}}o.gridSize=Math.max(Math.floor(o.gridSize),4);var s=o.gridSize;var u=s-o.maskGapWidth;var d=Math.abs(o.maxRotation-o.minRotation);var c=Math.min(o.maxRotation,o.minRotation);var h,v,m,w,g;var p;var M;function x(t,e){return"hsl("+(Math.random()*360).toFixed()+","+(Math.random()*30+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}switch(o.color){case"random-dark":M=function t(){return x(10,50)};break;case"random-light":M=function t(){return x(50,90)};break;default:if(typeof o.color==="function"){M=o.color}break}var b=null;if(typeof o.classes==="function"){b=o.classes}var C=false;var y=[];var I;var T=function t(e){var r=e.currentTarget;var a=r.getBoundingClientRect();var i;var n;if(e.touches){i=e.touches[0].clientX;n=e.touches[0].clientY}else{i=e.clientX;n=e.clientY}var o=i-a.left;var f=n-a.top;var l=Math.floor(o*(r.width/a.width||1)/s);var u=Math.floor(f*(r.height/a.height||1)/s);return y[l][u]};var k=function t(e){var r=T(e);if(I===r){return}I=r;if(!r){o.hover(undefined,undefined,e);return}o.hover(r.item,r.dimension,e)};var E=function t(e){var r=T(e);if(!r){return}o.click(r.item,r.dimension,e);e.preventDefault()};var S=[];var F=function t(e){if(S[e]){return S[e]}var r=e*8;var a=r;var i=[];if(e===0){i.push([w[0],w[1],0])}while(a--){var n=1;if(o.shape!=="circle"){n=o.shape(a/r*2*Math.PI)}i.push([w[0]+e*n*Math.cos(-a/r*2*Math.PI),w[1]+e*n*Math.sin(-a/r*2*Math.PI)*o.ellipticity,a/r*2*Math.PI])}S[e]=i;return i};var R=function t(){return o.abortThreshold>0&&(new Date).getTime()-p>o.abortThreshold};var P=function t(){if(o.rotateRatio===0){return 0}if(Math.random()>o.rotateRatio){return 0}if(d===0){return c}return c+Math.random()*d};var O=function t(e,a,i){var n=false;var f=o.weightFactor(a);if(f<=o.minSize){return false}var l=1;if(f<r){l=function t(){var e=2;while(e*f<r){e+=2}return e}()}var u=document.createElement("canvas");var d=u.getContext("2d",{willReadFrequently:true});d.font=o.fontWeight+" "+(f*l).toString(10)+"px "+o.fontFamily;var c=d.measureText(e).width/l;var h=Math.max(f*l,d.measureText("m").width,d.measureText("uFF37").width)/l;var v=c+h*2;var m=h*3;var w=Math.ceil(v/s);var g=Math.ceil(m/s);v=w*s;m=g*s;var p=-c/2;var M=-h*.4;var x=Math.ceil((v*Math.abs(Math.sin(i))+m*Math.abs(Math.cos(i)))/s);var b=Math.ceil((v*Math.abs(Math.cos(i))+m*Math.abs(Math.sin(i)))/s);var C=b*s;var y=x*s;u.setAttribute("width",C);u.setAttribute("height",y);if(n){document.body.appendChild(u);d.save()}d.scale(1/l,1/l);d.translate(C*l/2,y*l/2);d.rotate(-i);d.font=o.fontWeight+" "+(f*l).toString(10)+"px "+o.fontFamily;d.fillStyle="#000";d.textBaseline="middle";d.fillText(e,p*l,(M+f*.5)*l);var I=d.getImageData(0,0,C,y).data;if(R()){return false}if(n){d.strokeRect(p*l,M,c*l,h*l);d.restore()}var T=[];var k=b,E,S,F;var P=[x/2,b/2,x/2,b/2];while(k--){E=x;while(E--){F=s;t:{while(F--){S=s;while(S--){if(I[((E*s+F)*C+(k*s+S))*4+3]){T.push([k,E]);if(k<P[3]){P[3]=k}if(k>P[1]){P[1]=k}if(E<P[0]){P[0]=E}if(E>P[2]){P[2]=E}if(n){d.fillStyle="rgba(255, 0, 0, 0.5)";d.fillRect(k*s,E*s,s-.5,s-.5)}break t}}}if(n){d.fillStyle="rgba(0, 0, 255, 0.5)";d.fillRect(k*s,E*s,s-.5,s-.5)}}}}if(n){d.fillStyle="rgba(0, 255, 0, 0.5)";d.fillRect(P[3]*s,P[0]*s,(P[1]-P[3]+1)*s,(P[2]-P[0]+1)*s)}return{mu:l,occupied:T,bounds:P,gw:b,gh:x,fillTextOffsetX:p,fillTextOffsetY:M,fillTextWidth:c,fillTextHeight:h,fontSize:f}};var L=function t(e,r,a,i,n){var f=n.length;while(f--){var l=e+n[f][0];var s=r+n[f][1];if(l>=v||s>=m||l<0||s<0){if(!o.drawOutOfBound){return false}continue}if(!h[l][s]){return false}}return true};var z=function t(e,r,a,n,f,l,u,d,c){var h=a.fontSize;var v;if(M){v=M(n,f,h,l,u)}else{v=o.color}var m;if(b){m=b(n,f,h,l,u)}else{m=o.classes}var w;var g=a.bounds;w={x:(e+g[3])*s,y:(r+g[0])*s,w:(g[1]-g[3]+1)*s,h:(g[2]-g[0]+1)*s};i.forEach(function(t){if(t.getContext){var i=t.getContext("2d");var f=a.mu;i.save();i.scale(1/f,1/f);i.font=o.fontWeight+" "+(h*f).toString(10)+"px "+o.fontFamily;i.fillStyle=v;i.translate((e+a.gw/2)*s*f,(r+a.gh/2)*s*f);if(d!==0){i.rotate(-d)}i.textBaseline="middle";i.fillText(n,a.fillTextOffsetX*f,(a.fillTextOffsetY+h*.5)*f);i.restore()}else{var l=document.createElement("span");var u="";u="rotate("+-d/Math.PI*180+"deg) ";if(a.mu!==1){u+="translateX(-"+a.fillTextWidth/4+"px) "+"scale("+1/a.mu+")"}var w={position:"absolute",display:"block",font:o.fontWeight+" "+h*a.mu+"px "+o.fontFamily,left:(e+a.gw/2)*s+a.fillTextOffsetX+"px",top:(r+a.gh/2)*s+a.fillTextOffsetY+"px",width:a.fillTextWidth+"px",height:a.fillTextHeight+"px",lineHeight:h+"px",whiteSpace:"nowrap",transform:u,webkitTransform:u,msTransform:u,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};if(v){w.color=v}l.textContent=n;for(var g in w){l.style[g]=w[g]}if(c){for(var p in c){l.setAttribute(p,c[p])}}if(m){l.className+=m}t.appendChild(l)}})};var W=function t(e,r,a,n,o){if(e>=v||r>=m||e<0||r<0){return}h[e][r]=false;if(a){var f=i[0].getContext("2d");f.fillRect(e*s,r*s,u,u)}if(C){y[e][r]={item:o,dimension:n}}};var A=function t(e,r,a,n,f,l){var u=f.occupied;var d=o.drawMask;var c;if(d){c=i[0].getContext("2d");c.save();c.fillStyle=o.maskColor}var h;if(C){var w=f.bounds;h={x:(e+w[3])*s,y:(r+w[0])*s,w:(w[1]-w[3]+1)*s,h:(w[2]-w[0]+1)*s}}var g=u.length;while(g--){var p=e+u[g][0];var M=r+u[g][1];if(p>=v||M>=m||p<0||M<0){continue}W(p,M,d,h,l)}if(d){c.restore()}};var D=function t(e){var r,i,n;if(Array.isArray(e)){r=e[0];i=e[1]}else{r=e.word;i=e.weight;n=e.attributes}var f=P();var l=O(r,i,f);if(!l){return false}if(R()){return false}if(!o.drawOutOfBound){var s=l.bounds;if(s[1]-s[3]+1>v||s[2]-s[0]+1>m){return false}}var u=g+1;var d=function(t){var a=Math.floor(t[0]-l.gw/2);var o=Math.floor(t[1]-l.gh/2);var s=l.gw;var d=l.gh;if(!L(a,o,s,d,l.occupied)){return false}z(a,o,l,r,i,g-u,t[2],f,n);A(a,o,s,d,l,e);return true};while(u--){var c=F(g-u);if(o.shuffle){c=[].concat(c);a(c)}var h=c.some(d);if(h){return true}}return false};var B=function t(e,r,a){if(r){return!i.some(function(t){var i=document.createEvent("CustomEvent");i.initCustomEvent(e,true,r,a||{});return!t.dispatchEvent(i)},this)}else{i.forEach(function(t){var i=document.createEvent("CustomEvent");i.initCustomEvent(e,true,r,a||{});t.dispatchEvent(i)},this)}};var H=function t(){var e=i[0];if(e.getContext){v=Math.ceil(e.width/s);m=Math.ceil(e.height/s)}else{var r=e.getBoundingClientRect();v=Math.ceil(r.width/s);m=Math.ceil(r.height/s)}if(!B("wordcloudstart",true)){return}w=o.origin?[o.origin[0]/s,o.origin[1]/s]:[v/2,m/2];g=Math.floor(Math.sqrt(v*v+m*m));h=[];var a,n,f;if(!e.getContext||o.clearCanvas){i.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=o.backgroundColor;e.clearRect(0,0,v*(s+1),m*(s+1));e.fillRect(0,0,v*(s+1),m*(s+1))}else{t.textContent="";t.style.backgroundColor=o.backgroundColor;t.style.position="relative"}});a=v;while(a--){h[a]=[];n=m;while(n--){h[a][n]=true}}}else{var l=document.createElement("canvas").getContext("2d");l.fillStyle=o.backgroundColor;l.fillRect(0,0,1,1);var u=l.getImageData(0,0,1,1).data;var d=e.getContext("2d").getImageData(0,0,v*s,m*s).data;a=v;var c,M;while(a--){h[a]=[];n=m;while(n--){M=s;t:while(M--){c=s;while(c--){f=4;while(f--){if(d[((n*s+M)*v*s+(a*s+c))*4+f]!==u[f]){h[a][n]=false;break t}}}}if(h[a][n]!==false){h[a][n]=true}}}d=l=u=undefined}if(o.hover||o.click){C=true;a=v+1;while(a--){y[a]=[]}if(o.hover){e.addEventListener("mousemove",k)}if(o.click){e.addEventListener("click",E);e.addEventListener("touchstart",E);e.addEventListener("touchend",function(t){t.preventDefault()});e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"}e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t);e.removeEventListener("mousemove",k);e.removeEventListener("click",E);I=undefined})}f=0;var x,b;if(o.wait!==0){x=window.setTimeout;b=window.clearTimeout}else{x=window.setImmediate;b=window.clearImmediate}var T=function t(e,r){i.forEach(function(t){t.addEventListener(e,r)},this)};var S=function t(e,r){i.forEach(function(t){t.removeEventListener(e,r)},this)};var F=function t(){S("wordcloudstart",t);b(P)};T("wordcloudstart",F);var P=x(function t(){if(f>=o.list.length){b(P);B("wordcloudstop",false);S("wordcloudstart",F);return}p=(new Date).getTime();var e=D(o.list[f]);var r=!B("wordclouddrawn",true,{item:o.list[f],drawn:e});if(R()||r){b(P);o.abort();B("wordcloudabort",false);B("wordcloudstop",false);S("wordcloudstart",F);return}f++;P=x(t,o.wait)},o.wait)};H()};i.isSupported=e;i.minFontSize=r;if(typeof define==="function"&&define.amd){t.WordCloud=i;define("wordcloud",[],function(){return i})}else if(typeof module!=="undefined"&&module.exports){module.exports=i}else{t.WordCloud=i}})(this);

jQuery(document).ready(function($) {
    if($(".tag-view-switch").hasClass("done")) return;
    
    $(".tag-view-switch").on("click", "button", function() {
        $(".tag-view-switch button").removeClass("active");
        $(this).addClass("active");
        
        $(".tags-content").hide();
        $("#" + $(this).data("togget")).fadeIn();
    });
    
    var tag_base = mk_theme_api.home_url + "/tag/";
    var h = $("#tag-cloud-tooltip"), tagCloud = $('#tag-cloud-canvas');
    
    $(h).on("mouseover", function(event) {
        $(this).hide();
    });
    
    
    for(var i=0; i<lists.length; i++) {
        $("#tag-cloud-ball").append('<a href="' + tag_base + lists[i][0] + '/">' + lists[i][0] + '（' + lists[i][1] + '）</a>');
    }
    
    WordCloud(tagCloud[0], { 
        list: lists,
        drawOutOfBound: !1,
        weightFactor: 30,
        gridSize: 0,
        wait: 50,
        shape: "triangle",
        backgroundColor: "rgba(255,255,255,0.35)",
        rotateRatio: 1,
        minRotation: -30 * Math.PI / 180,
        maxRotation: 30 * Math.PI / 180,
        hover: function n(t, e, o) {
            t ? (h.html('<div class="tag-tooltip-title">标签：' + t[0] + '</div><div class="tag-tooltip-counts">' + 
            '一共出现<span>' + t[1] + ' </span> 次</div>' + 
            '<div class="tag-tooltip-tips">点击查看「<span>' + t[0] + "</span>」的相关文章</div>"), h.css({
                display: "block",
                left: o.clientX + 15 + "px",
                top: o.clientY + 15 + "px"
            }), tagCloud.css("cursor","pointer")) : (h.css("display", "none"), tagCloud.css("cursor","default"));
        },
        click: function n(t) {
            t && (location.href = tag_base + encodeURIComponent(t[0]) + "/");
        }
    });
    
    $(".tag-view-switch").addClass("done");
});
